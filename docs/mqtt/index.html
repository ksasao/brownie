<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="height=device-height,width=device-width,initial-scale=1.0">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>
        <title>Brownie QR</title>
        <style>
        body{
            position: absolute;
            top: 0%;
            left: 50%;
            margin-right: -50%;
            -webkit-transform: translate(-50%, 0%);
            transform: translate(-50%, 0%);
            font-family: sans-serif;
            color: #773030;
            background-color: #facd89;
        }
        a {
            color:#773030;
        }
        #main{
            width: 300px;
            text-align: center;
        }
        #navigation{
            font-size: 90%;
            text-align: left;
        }
        #footer{
            font-size: 80%;
            margin-top: 10px;
            padding-top: 10px;
        }
        #data{
            width: 280px;
            color: #777777;
            background-color: #ffffff;
            font-size: 80%;
            font-weight: bold;
            margin-top: 10px;
            padding-top: 10px;
            padding-left: 10px;
            padding-right: 10px;
            overflow-wrap: break-word;
            word-break: break-all;
            text-align: left;
        }
        .head{
            text-align: right;
            width: 20%;
        }
        table,td{
            width: 100%;
        }
        input {
            width: 100%;
            border: none;
            outline: none;
        }
        </style>
    </head>

    <body>
        <div id="main">
            <div id="navigation"><a href="../qr">QR</a> | <a href="../ifttt">IFTTT</a> | MQTT</div>
            <div id="data"></div>
            <div id="qrcodeBuffer" style="display:none;"></div>
            <div id="qrcode"><canvas id="qrcanvas" width="300px" height="300px"></canvas></div>
            <div id="userform">
                <form autocomplete="on" onsubmit="return false;">
                    <table>
                        <tr><td class="head">SSID:</td><td><input id="ssid" type="text" placeholder="your-wifi-ssid" autocorrect="off" autocapitalize="off"></td></tr>
                        <tr><td class="head">PASS:</td><td><input id="pass" type="text" placeholder="your-wifi-password" autocorrect="off" autocapitalize="off"></td></tr>
                        <tr><td class="head">MQTT:</td><td><input id="mqtt" type="text" placeholder="MQTT-WebSocket-address" autocorrect="off" autocapitalize="off"></td></tr>
                    </table>
                    <button type="submit" id="qrgen">OK</button>
                </form>
            </div>
            <div id="footer">Brownie QR Generator  Â© 2019 <a href="https://twitter.com/ksasao">ksasao</a></div>
        </div>
        <script>
        function updateQR(){
            var json = {};
            json.ssid = $("#ssid").val().trim();
            json.pass = $("#pass").val().trim();
            json.mqtt = $("#mqtt").val().trim();
            str = JSON.stringify(json);
            $("#data").text(str);

            // Draw QR code with white margin
            var margin = 30;
            $("#qrcodeBuffer").html("");
            $("#qrcodeBuffer").qrcode({width: qrcanvas.width - margin*2, height: qrcanvas.height - margin*2, text: str});
            var src=$("#qrcodeBuffer canvas")[0];
            var image = src.getContext('2d').getImageData(0,0,src.width,src.height);
            var ctx = qrcanvas.getContext('2d');
            ctx.fillStyle='white';
            ctx.fillRect(0,0,qrcanvas.width,qrcanvas.height);
            ctx.putImageData(image, margin,margin);
            ctx.fill();
        }
        $("#qrgen").on("click",function(){
            updateQR();
        });
        $("input").blur(function(){
            updateQR();
        });
        $(function(){
            updateQR();
        });
        </script>
    </body>
</html>